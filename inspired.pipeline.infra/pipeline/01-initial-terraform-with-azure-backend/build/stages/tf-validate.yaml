parameters:
  tf_version:
  working_directory:

stages:
  - stage: tfvalidate
    displayName: Validate Terraform
    variables:
      - name: backend_tfvars
        value: "${{ parameters.working_directory }}/tf/backend/backend.ci.tfvars"
    jobs:
      - job: tfvalidatejob
        displayName: 'Validate Terraform'
        steps:
          - checkout: self
          - task: TerraformInstaller@0
            displayName: "Use Terraform ${{ parameters.tf_version }}"
            inputs:
              terraformVersion: ${{ parameters.tf_version }}
          - bash: |
              terraform init -backend-config=$(backend_tfvars) -input=false
            
            displayName: Initialize configuration
            failOnStderr: true

          - bash: terraform validate
            displayName: Validate Terraform configuration
            failOnStderr: true